---
AWSTemplateFormatVersion: '2010-09-09'
Description: 'DB deployment'
Parameters:
  ECClusterName:
    Description: 'Elasticache Cluster name'
    Type: String
  ECSecurityGroupName:
    Description: 'Security Group name for Elasticache'
    Type: String
  ECSubnetGroupName:
    Description: 'Subnet Group name for Elasticache'
    Type: String
  ECNodeType:
    Description: 'Elasticache cache size'
    Default: 'cache.t2.micro'
    Type: String
  Vpc:
    Description: 'VPC Identifier'
    Type: String
  AvailabilityZones:
    Description: 'Availability Zones'
    Type: CommaDelimitedList
  Subnets:
    Description: 'Subnets for the Availability Zones'
    Type: CommaDelimitedList

Resources:
  ElastiCache:
    Type: AWS::ElastiCache::CacheCluster
    Properties:
      Engine: "redis"
      ClusterName: !Ref ECClusterName
      CacheNodeType: !Ref ECNodeType
      NumCacheNodes: 1
      PreferredAvailabilityZone: !Ref AvailabilityZones
      VpcSecurityGroupIds:
      - !Ref ECSecurityGroup
      CacheSubnetGroupName: !Ref ECSubnetGroup
  ECSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupName: !Ref ECSecurityGroupName
      GroupDescription: 'Elasticache Security Group'
      VpcId: !Ref Vpc
  ECSubnetGroup:
    Type: AWS::ElastiCache::SubnetGroup
    Properties:
      CacheSubnetGroupName: !Ref ECSubnetGroupName
      Description: 'Elasticache Subnet Group'
      SubnetIds: !Ref Subnets
